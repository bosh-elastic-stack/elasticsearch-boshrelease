---
name: elasticsearch

templates:
  bin/ctl: bin/ctl
  bin/post-start: bin/post-start
  bin/pre-start: bin/pre-start
  bin/drain: bin/drain
  bin/ctl_utils.sh: bin/ctl_utils.sh
  config/elasticsearch.yml: config/elasticsearch.yml
  config/jvm.options: config/jvm.options
  config/log4j2.properties: config/log4j2.properties

packages:
- elasticsearch

provides:
- name: elasticsearch
  type: elasticsearch
  properties:
  - elasticsearch.cluster_name

consumes:
- name: elasticsearch
  type: elasticsearch
  optional: true

properties:
  elasticsearch.log_level:
    description: The default logging level (e.g. WARN, DEBUG, INFO)
    default: INFO
  elasticsearch.exec.options:
    description: An array of additional options to pass when starting elasticsearch
    default: []
  elasticsearch.heap_size:
    description: sets jvm heap sized
  elasticsearch.jvm_options:
    description: Additional Java Virtual Machine options
    default: []
  elasticsearch.cluster_name:
    description: The name of the elastic search cluster
    default: "bosh_es"
  elasticsearch.node.allow_master:
    description: Allow node to become master? (true / false)
    default: true
  elasticsearch.node.allow_data:
    description: Allow node to store data? (true / false)
    default: true
  elasticsearch.node.allow_ingest:
    description: Allow node to become ingest node? (true / false)
    default: false
  elasticsearch.health.timeout:
    description: Post-start timeout for node to join cluster (seconds)
    default: 300
  elasticsearch.health.interval:
    description: Post-start interval for node to join cluster (seconds)
    default: 15
  elasticsearch.discovery.minimum_master_nodes:
    description: The minimum number of master eligible nodes a node should "see" in order to operate within the cluster. Recommended to set it to a higher value than 1 when running more than 2 nodes in the cluster.
    default: "auto"
  elasticsearch.plugins:
    description: "Plugins to run elasticsearch with (array[] = { plugin-name: install-source }; e.g. [ { analysis-kuromoji: 'analysis-kuromoji' } ])"
    default: []
  elasticsearch.plugin_install_opts:
    description: "Command line parameters for 'elasticsearch-plugin install'"
    default: []
  elasticsearch.health.disable_post_start:
    description: Allow node to run post-start script? (true / false)
    default: false
  elasticsearch.cluster.routing.allocation.enable_post_start:
    description: |
      The strategy to enable allocation for specific kinds of shards (all / primaries / new_primaries) 
      see also https://www.elastic.co/guide/en/elasticsearch/reference/current/shards-allocation.html
    default: all
  xpack.monitoring.enabled:
    description: Set to `true` (default) to enable Elasticsearch X-Pack monitoring for Elasticsearch on the node.
  xpack.monitoring.collection.enabled:
    description: Set to `true` to enable the collection of monitoring data. When this setting is `false` (default), Elasticsearch monitoring data is not collected and all monitoring data from other sources such as Kibana, Beats, and Logstash is ignored.
  xpack.monitoring.collection.interval:
    description: Controls how often data samples are collected. Defaults to `10s`. If you modify the collection interval, set the `xpack.monitoring.min_interval_seconds` option in `kibana.yml` to the same value.
  xpack.monitoring.elasticsearch.collection.enabled:
    description: Controls whether statistics about your Elasticsearch cluster should be collected. Defaults to `true`. This is different from xpack.monitoring.collection.enabled, which allows you to enable or disable all monitoring collection. However, this setting simply disables the collection of Elasticsearch data while still allowing other data (e.g., Kibana, Logstash, Beats, or APM Server monitoring data) to pass through this cluster.
  xpack.monitoring.collection.cluster.stats.timeout:
    description: Sets the timeout for collecting the cluster statistics. Defaults to `10s`.
  xpack.monitoring.collection.indices:
    description: Controls which indices Monitoring collects data from. Defaults to all indices. Specify the index names as a comma-separated list, for example `test1,test2,test3`. Names can include wildcards, for example `test*`. You can explicitly include or exclude indices by prepending `+` to include the index, or `-` to exclude the index. For example, to include all indices that start with `test` except `test3`, you could specify `+test*,-test3`.
  xpack.monitoring.collection.index.stats.timeout:
    description: Sets the timeout for collecting index statistics. Defaults to `10s`.
  xpack.monitoring.collection.index.recovery.active_only:
    description: Controls whether or not all recoveries are collected. Set to `true` to collect only active recoveries. Defaults to `false`.
  xpack.monitoring.collection.index.recovery.timeout:
    description: Sets the timeout for collecting the recovery information. Defaults to `10s`.
  xpack.monitoring.history.duration:
    description: |
      Sets the retention duration beyond which the indices created by a Monitoring exporter are automatically deleted. Defaults to `7d` (7 days).
      This setting has a minimum value of `1d` (1 day) to ensure that something is being monitored, and it cannot be disabled.
  xpack.monitoring.exporters:
    description: Configures where the agent stores monitoring data. By default, the agent uses a local exporter that indexes monitoring data on the cluster where it is installed. Use an HTTP exporter to send data to a separate monitoring cluster.